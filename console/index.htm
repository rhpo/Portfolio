<!DOCTYPE html>
<script src="https://code.jquery.com/jquery-3.6.0.slim.min.js" crossorigin="anonymous"></script>
<style>
    .c {
        resize: none;
        overflow: none;
        background-color: black;
        color: chartreuse;
        width: 100%;
        height: 100vh;
        top: 0;
        left: 0;
        border: none;
        font-family: Consolas, monaco, monospace;
        font-size: 17px;
        caret-color: white;
        outline-style: none;
        box-shadow: none;
        border-color: transparent;
    }

    body {
        background-color: black;
    }
</style>

<head>
   <title>Ramy's Console</title>
</head>

<body>
    <textarea name="c" id="c" class="c" spellcheck="false"></textarea>
</body>
<script src="https://code.jquery.com/jquery-3.6.0.slim.min.js"></script>
<script>
    var user_ip;
    fetch("https://www.wtfismyip.com/text").then(_=>_.text()).then(__=>(user_ip=__));
    function ranInt(m, x) {
        return Math.floor(Math.random() * (x - m + 1)) + m;
    }
    var usr = (`user${ranInt(1000, 9999)}`);
    var e = usr + ":~# ";
    _$("c").value = e;
    function _$(elm = '') {
        return document.getElementById(elm);
    }

    _$('c').addEventListener("keypress", function (event) {
        if (event.key === "Enter") {
            event.preventDefault();
            var terminalText = $('#c').val();
            var terminalLines = terminalText.split('\n');
            var keys = Object.keys(terminalLines);
            var last = keys[keys.length - 1];
            var s = terminalLines[last].slice(e.length);
            main(s);
        }
    });
    _$('c').addEventListener("keydown", function (event) {
        if (event.keyCode === 8) {
            var terminalText = $('#c').val();
            var terminalLines = terminalText.split('\n');
            var intBeforeLastLine;
            terminalLines.forEach(element => {
                intBeforeLastLine += element.length;
            });
            var cursorPosition = $('#c').prop("selectionStart");
            cursorPosition -= intBeforeLastLine;
            if (cursorPosition <= e.length) {
                event.preventDefault();
            }
        }
    });


    function main(t = '') {
        while (t.includes('  ') || t.includes("   ")) {
            t = t.replace("  ", ' ').replace("   ", " ");
        }
        while (t.startsWith(" ")) {
            t = t.slice(1);
        }
        var arg = t.split(" ");
        var element = arg[0];
        if (element === '') {
            return terminal.reset();
        }
        var cmd = arg[0];
        t = t.replace("|href|", window.location.href)
            .replace("|user|", usr)
            .replace('|time|', Date.now().toString())
            .replace("|ip|", user_ip);
        switch (cmd) {
            case "echo":
                terminal.lineLog(t.slice(5))
                break;
            case "whoami":
                terminal.lineLog(usr);
                break;
                case "refresh":
                    window.location.href = window.location.href;
                    break;
                    case "clear":
                        case "cls":
                            case "reset":
                                return terminal.change(e);
                                break;
            default:
                terminal.lineLog(cmd + ": Command not found.")
                break;

            case "terminal":
                if (arg.length < 2) {
                    return terminal.lineLog(`${cmd}: Please specify the 2nd argument.\nExample: terminal {Command}`);
                } else {
                    switch (arg[1]) {
                        case "rename":
                            if (arg.length < 3) {
                                terminal.lineLog(`${cmd}: Please specify the new Name.\nExample: terminal renameuser MyNewName`);
                                terminal.reset();
                            } else {
                                usr=arg[2]
                            }
                            break;
                        case "color":
                            if (arg.length < 3) {
                                terminal.lineLog(`${cmd}: Please specify a new terminal color (3rd argument not found!)`)
                            }
                            else {
                                $("#c").css("color", arg[2]);
                                terminal.setState(true)
                            }
                            break;
                    }
                }
                break;
        }
        terminal.reset();
    }

    window.onload = () => {
        document.getElementById("c").focus();
    }

    var terminal = new Object();
    terminal.log = function log(string = "") {
        _$('c').value += string;
    }
    terminal.logLine = function log(string = "") {
        _$('c').value += string + '\n';
    }
    terminal.lineLog = function lnLog(string = "") {
        _$('c').value += "\n" + string;
        document.title = "Console | " + string;
    }
    terminal.reset = function rst() {
        _$('c').value += `\n${e}`;
    }
    terminal.change = function change(string = "") {
        _$('c').value = string;
    }
    terminal.setState = (conditional) => { terminal.lineLog(conditional === false ? 0 : 1) }
</script>